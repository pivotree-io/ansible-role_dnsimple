#+TITLE: Readme

* DNSimple Role
- Purpose of this role is to iterate over a hosts list in YAML, check for existing records, and in the case there is no record to create one in the supplied domain.
* Requirements
- Python Libraries:
  - dnsimple
  - dnspython
  - jmespath
* Role Variables
#+begin_src
dnsimple_user: '#This should reference: vaut.<user>.user'
dnsimple_key: '#This should reference: vaut.<key>.user'
dnsimple_domain: '#This is the DNSimple Domain to work under: https://dnsimple.com/a/<acct#>/domains'
dnsimple_sandbox: '#Set to true if this is a sandbox account, otherwise False'
dnsimple_account_id: '#Found under the correct domain you want to access, instead of a userID'
dnsimple_hosts_to_add: '#Dictionary describing hosts to add, see [[#-example-playbook-][Example Playbook]]'
vault:
  sandbox:
    user: "{{ vault_account1.vault_user }}"
    key: "{{ vault_account2.vault_key }}"

dnsimple_headers:
  Authorization: "Bearer {{ vault.sandbox.key }}"
  Accepts:  "application/json"
#+end_src
* Vault
- vault.yml content should contain your API keys and usernames, and referenced in your playbook variables as shown above for easy search via grep. Vault should looke like:
  #+begin_src
vault_account1 :
  vault_user: user@email.net
  vault_key: <api-key>

vault_account2:
  vault_user: user@email.net
  vault_key: <api-key>
  #+end_src
* Example Playbook
:PROPERTIES:
:CUSTOM_ID: -example-playbook-
:END:
#+begin_src yaml
---
- name: update DNSimple records
  hosts: localhost
  vars:
    dnsimple_user: "{{ vault.sandbox.user }}"
    dnsimple_key: "{{ vault.sandbox.key }}"
    dnsimple_domain: "sassyatemyclothes.com"
    dnsimple_sandbox: True
    dnsimple_account_id: 1691
    dnsimple_headers:
      Authorization: "Bearer {{ vault.sandbox.key }}"
      Accepts:  "application/json"

    dnsimple_hosts_to_add:
      - hostname: test-record-one
        record_type: A
        ip_addr: 127.0.0.1
      - hostname:  test-record-two
        record_type: A
        ip_addr: 127.0.0.2
      - hostname: test-record-three
        record_type: A
        ip_addr: 127.0.0.3

    vault:
      account1:
        user: "{{ vault_sandbox.vault_user }}"
        key: "{{ vault_sandbox.vault_key }}"
  roles:
    - { role: dnsimple }
...
#+end_src
* TODO Add per host record type: cname, a, mx, txt, etc
